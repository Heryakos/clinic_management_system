<div class="injection-card">
  <div class="dialog-title">
    <h2>{{ data.dialogTitle }}</h2>
    <button type="button" class="close-btn" (click)="dialogRef.close()">Close</button>
  </div>

  <div *ngIf="isLoading" class="loading">Loading injection data...</div>

  <div *ngIf="errorMessage" class="error-message" [ngClass]="{'success-message': !isLoading && errorMessage.includes('successfully')}">
    {{ errorMessage }}
  </div>

  <form [formGroup]="injectionForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading && !errorMessage">
    <div class="header">
      <div class="header-content">
        <div class="logo">
          <img [src]="logoPath" alt="Clinic Logo" class="logo-img" />
        </div>
        <div class="clinic-info">
          <h1>FEDERAL HOUSING CORPORATION MEDIUM CLINIC</h1>
          <div class="clinic-phone">TEL. 0118 553615</div>
        </div>
      </div>
    </div>

    <div class="title-section">
      <h2>Injection Paper</h2>
    </div>

    <div class="form-actions">
      <button type="button" class="action-btn print-btn" (click)="printInjection()">Print</button>
      <button type="button" class="action-btn pdf-btn" (click)="exportToPDF()">Export to PDF</button>
      <button type="button" class="action-btn edit-btn" (click)="toggleEditMode()">
        {{ isEditing ? 'Cancel Edit' : 'Edit' }}
      </button>
      <button type="submit" class="action-btn save-btn" *ngIf="isEditing">Save Changes</button>
    </div>

    <div class="patient-section">
      <div class="form-grid">
        <div class="form-row two-line-row">
          <div class="form-group">
            <label>Patient's Full Name:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" formControlName="FullName" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Town/Region:</label>
            <div class="input-container small">
              <input type="text" class="underline-input form-control" formControlName="woreda" [readonly]="!isEditing" />
            </div>
          </div>
          <div class="form-group">
            <label>Woreda:</label>
            <div class="input-container small">
              <input type="text" class="underline-input form-control" formControlName="woreda" [readonly]="!isEditing" />
            </div>
          </div>
          <div class="form-group">
            <label>Kebele/House No:</label>
            <div class="input-container small">
              <input type="text" class="underline-input form-control" formControlName="houseNo" [readonly]="!isEditing" />
            </div>
          </div>
          <div class="form-group">
            <label>Tel No:</label>
            <div class="input-container small">
              <input type="text" class="underline-input form-control" formControlName="phone" [readonly]="!isEditing" />
            </div>
          </div>
        </div>
        <div class="form-row two-line-row">
          <div class="form-group">
            <label>Sex:</label>
            <div class="input-container small">
              <input type="text" class="underline-input form-control" formControlName="gender" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Age:</label>
            <div class="input-container small">
              <input type="number" class="underline-input form-control" formControlName="age" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Weight:</label>
            <div class="input-container small">
              <input type="number" class="underline-input form-control" formControlName="Weight" [readonly]="!isEditing" />
            </div>
          </div>
          <div class="form-group">
            <label>Card No:</label>
            <div class="input-container small">
              <input type="text" class="underline-input form-control" formControlName="CardNumber" readonly />
            </div>
          </div>
        </div>
        <div class="form-group full-width">
          <label>Diagnosis:</label>
          <div class="input-container">
            <input type="text" class="underline-input form-control" formControlName="MedicalHistory" readonly />
          </div>
        </div>
      </div>
    </div>

    <div class="injection-section">
      <table class="injection-table">
        <thead>
          <tr>
            <th class="injection-header" colspan="2">Injection Details</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="label-cell">Injection Number:</td>
            <td class="value-cell">{{ injectionForm.get('injectionNumber')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Date:</td>
            <td class="value-cell">{{ injectionForm.get('injectionDate')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Status:</td>
            <td class="value-cell">{{ injectionForm.get('status')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Physician:</td>
            <td class="value-cell">{{ injectionForm.get('orderingPhysicianName')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Medication:</td>
            <td class="value-cell">
              {{ injectionForm.get('medicationName')?.value || 'N/A' }} 
              <span *ngIf="injectionForm.get('strength')?.value">
                ({{ injectionForm.get('strength')?.value }} {{ injectionForm.get('dosageForm')?.value }})
              </span>
            </td>
          </tr>
          <tr>
            <td class="label-cell">Dose:</td>
            <td class="value-cell">{{ injectionForm.get('dose')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Route:</td>
            <td class="value-cell">{{ injectionForm.get('route')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Site:</td>
            <td class="value-cell">{{ injectionForm.get('site')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Frequency:</td>
            <td class="value-cell">{{ injectionForm.get('frequency')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Duration:</td>
            <td class="value-cell">{{ injectionForm.get('duration')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Instructions:</td>
            <td class="value-cell">{{ injectionForm.get('instructions')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Notes:</td>
            <td class="value-cell">{{ injectionForm.get('notes')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Administered By:</td>
            <td class="value-cell">{{ injectionForm.get('administeredByName')?.value || 'N/A' }}</td>
          </tr>
          <tr>
            <td class="label-cell">Administered Date:</td>
            <td class="value-cell">{{ injectionForm.get('administeredDate')?.value || 'N/A' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="info-section">
      <div class="info-column">
        <h3>Physician's</h3>
        <div class="info-fields">
          <div class="form-group">
            <label>Full Name:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" formControlName="orderingPhysicianName" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Qualification:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" [value]="''" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Registration:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" [value]="''" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Signature:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" [value]="''" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Date:</label>
            <div class="input-container">
              <input type="date" class="underline-input form-control" formControlName="injectionDate" readonly />
            </div>
          </div>
        </div>
      </div>
      <div class="info-column">
        <h3>Administered By</h3>
        <div class="info-fields">
          <div class="form-group">
            <label>Full Name:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" formControlName="administeredByName" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Qualification:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" [value]="''" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Registration:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" [value]="''" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Signature:</label>
            <div class="input-container">
              <input type="text" class="underline-input form-control" [value]="''" readonly />
            </div>
          </div>
          <div class="form-group">
            <label>Date:</label>
            <div class="input-container">
              <input type="date" class="underline-input form-control" formControlName="administeredDate" readonly />
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- Debug section - remove this in production -->
  <div *ngIf="injectionData" class="debug-section" style="display: none;">
    <h3>Debug Data</h3>
    <pre>{{ injectionData | json }}</pre>
    <pre>Form Value: {{ injectionForm.value | json }}</pre>
  </div>
</div>