<div class="reports-container">
    <!-- Language Toggle -->
    <div class="language-toggle no-print">
        <button type="button" class="lang-btn" (click)="toggleLanguage()">
            {{ reportLang === 'en' ? '·ä†·àõ' : 'EN' }}
        </button>
    </div>

    <!-- Report Header -->
    <div class="report-header">
        <h1>{{ getText('title') }}</h1>

        <div class="report-controls">
            <div class="control-group">
                <label>{{ getText('dateRange') }} - Start</label>
                <input type="date" [(ngModel)]="startDate" class="form-control">
            </div>

            <div class="control-group">
                <label>{{ getText('dateRange') }} - End</label>
                <input type="date" [(ngModel)]="endDate" class="form-control">
            </div>

            <div class="action-buttons">
                <button type="button" class="btn btn-primary" (click)="generateReport()" [disabled]="isLoading">
                    <span class="btn-icon">üìä</span>
                    {{ getText('generate') }}
                </button>
                <button type="button" class="btn btn-success" (click)="exportToPDF()" [disabled]="isLoading">
                    <span class="btn-icon">üìÑ</span>
                    {{ getText('exportPdf') }}
                </button>
                <button type="button" class="btn btn-secondary" (click)="printReport()" [disabled]="isLoading">
                    <span class="btn-icon">üñ®Ô∏è</span>
                    {{ getText('print') }}
                </button>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
        <div class="loading-spinner"></div>
        <div class="loading-text">Generating report...</div>
    </div>

    <!-- Report Content -->
    <div *ngIf="!isLoading" #reportContent class="report-content">
        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <h3>{{ getText('totalPayments') }}</h3>
                <div class="summary-value">{{ paymentSummary.totalPayments || 0 }}</div>
                <div class="summary-label">{{ getText('count') }}</div>
            </div>

            <div class="summary-card">
                <h3>{{ getText('totalAmount') }}</h3>
                <div class="summary-value">{{ formatCurrency(paymentSummary.totalAmount || 0) }}</div>
                <div class="summary-label">{{ getText('birr') }}</div>
            </div>

            <div class="summary-card">
                <h3>{{ getText('averagePayment') }}</h3>
                <div class="summary-value">{{ formatCurrency(paymentSummary.averagePayment || 0) }}</div>
                <div class="summary-label">{{ getText('birr') }}</div>
            </div>
        </div>

        <!-- Data Period Info -->
        <div class="period-info" *ngIf="paymentTrends.length > 0">
            <div class="period-badge">
                üìÖ Data Period: {{ paymentTrends[0]?.date }} - {{ paymentTrends[paymentTrends.length - 1]?.date }}
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <!-- Trends Chart -->
            <div class="chart-row full-width">
                <div class="chart-container">
                    <div class="chart-title">{{ getText('trends') }}</div>
                    <div id="trendsChart" class="chart"></div>
                </div>
            </div>

            <div class="chart-row">
                <!-- Department Chart -->
                <div class="chart-container">
                    <div class="chart-title">{{ getText('departmentBreakdown') }}</div>
                    <div id="departmentChart" class="chart"></div>
                </div>

                <!-- Method Chart -->
                <div class="chart-container">
                    <div class="chart-title">{{ getText('methods') }}</div>
                    <div id="methodChart" class="chart"></div>
                </div>
            </div>
            <!-- Age Group Chart -->
            <div class="chart-container">
                <div class="chart-title">{{ getText('ageGroupBreakdown') }}</div>
                <div id="ageChart" class="chart"></div>
            </div>

            <!-- Gender Chart -->
            <div class="chart-container">
                <div class="chart-title">{{ getText('genderBreakdown') }}</div>
                <div id="genderChart" class="chart"></div>
            </div>
            <!-- Detailed Payments Table -->
            <div class="data-table">
                <h3>{{ reportLang === 'am' ? '·ãù·à≠·ãù·à≠ ·ä≠·çç·ã´·ãé·âΩ' : 'Detailed Payments' }}</h3>
                <div class="table-container">
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>{{ reportLang === 'am' ? '·ã®Pv ·âÅ·å•·à≠' : 'Pv Number' }}</th>
                                <th>{{ reportLang === 'am' ? '·ã®·â∞·ä®·çà·àà·àà·âµ ·àµ·àù (·ä•·äï·åç·àä·ãù·äõ)' : 'Payee Name (En)' }}</th>
                                <th>{{ reportLang === 'am' ? '·ã®·â£·äï·ä≠ ·àò·àà·ã´ ·âÅ·å•·à≠' : 'Bank Account No' }}</th>
                                <th>{{ reportLang === 'am' ? '·àò·å†·äï' : 'Amount' }}</th>
                                <th>{{ reportLang === 'am' ? '·ã®·ä≠·çç·ã´ ·âÄ·äï' : 'Payment Date' }}</th>
                                <th>{{ reportLang === 'am' ? '·â≥·ä´·àö ·àµ·àù' : 'Patient Name' }}</th>
                                <th>{{ reportLang === 'am' ? '·ã®·ä≠·çç·ã´ ·âÅ·å•·à≠' : 'Reimbursement No' }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let p of detailedPayments">
                                <td>{{ p.pvNumber || 'N/A' }}</td>
                                <td>{{ p.payeeNameEn || 'N/A' }}</td>
                                <td>{{ p.payeeBankAccountNo || 'N/A' }}</td>
                                <td>{{ formatCurrency(p.paymentAmount) }}</td>
                                <td>{{ p.paymentDate | date: 'shortDate' }}</td>
                                <td>{{ p.patientName || 'N/A' }}</td>
                                <td>{{ p.reimbursementNumber || 'N/A' }}</td>
                            </tr>
                            <tr *ngIf="detailedPayments.length === 0">
                                <td colspan="7" class="no-data">
                                    {{ reportLang === 'am' ? '·ã≥·â≥ ·ã®·àà·àù' : 'No payments found' }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Data Tables -->
        <!-- Age Group Table -->
        <div class="data-table">
            <h3>{{ getText('ageGroupBreakdown') }}</h3>
            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>{{ getText('ageGroup') }}</th>
                            <th>{{ getText('count') }}</th>
                            <th>{{ getText('amount') }}</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let group of ageGroupBreakdown">
                            <td>{{ group.ageGroup }}</td>
                            <td>{{ group.count }}</td>
                            <td>{{ formatCurrency(group.amount) }}</td>
                            <td>{{ getPercentage(group.amount, paymentSummary.totalAmount) }}%</td>
                        </tr>
                        <tr *ngIf="ageGroupBreakdown.length === 0">
                            <td colspan="4" class="no-data">{{ reportLang === 'am' ? '·ã≥·â≥ ·ã®·àà·àù' : 'No data available' }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Gender Table -->
        <div class="data-table">
            <h3>{{ getText('genderBreakdown') }}</h3>
            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>{{ getText('gender') }}</th>
                            <th>{{ getText('count') }}</th>
                            <th>{{ getText('amount') }}</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let g of genderBreakdown">
                            <td>{{ g.gender }}</td>
                            <td>{{ g.count }}</td>
                            <td>{{ formatCurrency(g.amount) }}</td>
                            <td>{{ getPercentage(g.amount, paymentSummary.totalAmount) }}%</td>
                        </tr>
                        <tr *ngIf="genderBreakdown.length === 0">
                            <td colspan="4" class="no-data">{{ reportLang === 'am' ? '·ã≥·â≥ ·ã®·àà·àù' : 'No data available' }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>